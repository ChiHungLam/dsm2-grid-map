#summary This page describes how to use a sub project dsm2-input-grid to parse the text input files associated with DSM2 Hydro, Qual and PTM
#labels Featured
= Introduction =
DSM2 model input is in text files that are loosely structured. The data is represented by tables that have the following format
{{{
<TABLE_NAME><END_OF_LINE>
<HEADER1><WHITESPACE><HEADER2><WHITESPACE>....<HEADER_?><END_OF_LINE>
<VALUE1><WHITESPACE><VALUE2><WHITESPACE>...<VALUE?><END_OF_LINE>
<<MORE VALUE ROWS>><END_OF_LINE>
...
END<END_OF_LINE>
}}}

= Download =
The latest version is available [http://dsm2-grid-map.googlecode.com/files/dsm2-input-model.jar here]
= Details =

The javadocs are a good place to start are [http://dsm2-grid-map.googlecode.com/svn/trunk/dsm2-input-model/doc/index.html here]. The main class is 
[http://dsm2-grid-map.googlecode.com/svn/trunk/dsm2-input-model/doc/gov/ca/dsm2/input/parser/Parser.html Parser] which is used as shown in the jython session below.

The parser maintains the in memory model in a [http://dsm2-grid-map.googlecode.com/svn/trunk/dsm2-input-model/doc/gov/ca/dsm2/input/parser/Tables.html Tables] structure that consists of [http://dsm2-grid-map.googlecode.com/svn/trunk/dsm2-input-model/doc/gov/ca/dsm2/input/parser/InputTable.html InputTables] which are a one-to-one representation of the structure defined [#Introduction above].

[http://dsm2-grid-map.googlecode.com/svn/trunk/dsm2-input-model/doc/gov/ca/dsm2/input/parser/Tables.html Tables] also has converters [http://dsm2-grid-map.googlecode.com/svn/trunk/dsm2-input-model/doc/gov/ca/dsm2/input/parser/Tables.html#toDSM2Model() to] and [http://dsm2-grid-map.googlecode.com/svn/trunk/dsm2-input-model/doc/gov/ca/dsm2/input/parser/Tables.html#fromDSM2Model(gov.ca.dsm2.input.model.DSM2Model) from] a higher level model structure [http://dsm2-grid-map.googlecode.com/svn/trunk/dsm2-input-model/doc/gov/ca/dsm2/input/model/DSM2Model.html DSM2Model]. This model structure represents [http://dsm2-grid-map.googlecode.com/svn/trunk/dsm2-input-model/doc/gov/ca/dsm2/input/model/Nodes.html nodes], [http://dsm2-grid-map.googlecode.com/svn/trunk/dsm2-input-model/doc/gov/ca/dsm2/input/model/Channels.html channels], [http://dsm2-grid-map.googlecode.com/svn/trunk/dsm2-input-model/doc/gov/ca/dsm2/input/model/Reservoirs.html reservoirs], [http://dsm2-grid-map.googlecode.com/svn/trunk/dsm2-input-model/doc/gov/ca/dsm2/input/model/Gates.html gates], [http://dsm2-grid-map.googlecode.com/svn/trunk/dsm2-input-model/doc/gov/ca/dsm2/input/model/BoundaryInputs.html boundary inputs] and [http://dsm2-grid-map.googlecode.com/svn/trunk/dsm2-input-model/doc/gov/ca/dsm2/input/model/Outputs.html outputs] at a top level with associated information such as [http://dsm2-grid-map.googlecode.com/svn/trunk/dsm2-input-model/doc/gov/ca/dsm2/input/model/XSection.html xsection] at the appropriate object such as a [http://dsm2-grid-map.googlecode.com/svn/trunk/dsm2-input-model/doc/gov/ca/dsm2/input/model/Channel.html channel]

If you are familiar with jython then adding the jar to the classpath, the session in jython below can help you get started
{{{
>>> from gov.ca.dsm2.input.parser import *
>>> from gov.ca.dms2.input.model import *
>>> p=Parser()                                 
>>> tables = p.parseModel('hydro.inp')
[Input Table: ENVVAR, Input Table: SCALAR, Input Table: IO_FILE, Input Table: CHANNEL, Input Table: XSECT, Input Table: XSECT_LAYER, Input Table: RESERVOIR, Input Table: RESERVOIR_CONNECTION, Input Table: GATE, Input Table: GATE_WEIR_DEVICE, Input Table: GATE_PIPE_DEVICE, Input Table: TRANSFER, Input Table: CHANNEL_IC, Input Table: RESERVOIR_IC, Input Table: BOUNDARY_STAGE, Input Table: BOUNDARY_FLOW, Input Table: SOURCE_FLOW, Input Table: SOURCE_FLOW_RESERVOIR, Input Table: INPUT_GATE, Input Table: INPUT_TRANSFER_FLOW, Input Table: OPERATING_RULE, Input Table: OPRULE_EXPRESSION, Input Table: OPRULE_TIME_SERIES, Input Table: OUTPUT_CHANNEL, Input Table: OUTPUT_RESERVOIR, Input Table: OUTPUT_GATE]
>>> channel = tables.getTableNamed('CHANNEL')
>>> channels = tables.toChannels()
>>> channels.getChannel('432')
gov.ca.dsm2.input.model.Channel@6ce931d9
>>> ch432 = channels.getChannel('432')
>>> ch432.length
15812.0
>>> ch432.mannings
0.018
>>> ch432.id
u'432'
>>> ch432.xsections
[gov.ca.dsm2.input.model.XSection@1786ed7a, gov.ca.dsm2.input.model.XSection@1b50f0a7, gov.ca.dsm2.input.model.XSection@5ee771f3]
>>> ch432.xsections[0].channelId
u'432'
>>> ch432.xsections[0].distance 
0.243
>>> 
}}}